// AST with simple while-based traversal

fn make_node(type, val) {
    let node = alloc(4)
    node[0] = type
    node[1] = val
    node[2] = 0
    node[3] = 0
    return node
}

fn main() {
    print(888888)
    
    // Build tree: FN -> BLOCK -> LET -> NUM
    //                         -> LET -> NUM
    
    let fn_node = make_node(2, 109)
    let block = make_node(3, 0)
    let let_x = make_node(4, 120)
    let num_42 = make_node(5, 42)
    let let_y = make_node(4, 121)
    let num_100 = make_node(5, 100)
    
    // Link tree
    fn_node[2] = block
    block[2] = let_x
    let_x[2] = num_42
    let_x[3] = let_y
    let_y[2] = num_100
    
    print(777777)
    
    // Manual traversal (hardcoded for now)
    // Level 0: FN
    let t = fn_node[0]
    let v = fn_node[1]
    print(0)
    print(t)
    print(v)
    
    // Level 1: BLOCK
    let n1 = fn_node[2]
    t = n1[0]
    v = n1[1]
    print(1000)
    print(t)
    print(v)
    
    // Level 2: LET x
    let n2 = n1[2]
    t = n2[0]
    v = n2[1]
    print(2000)
    print(t)
    print(v)
    
    // Level 3: NUM 42
    let n3 = n2[2]
    t = n3[0]
    v = n3[1]
    print(3000)
    print(t)
    print(v)
    
    // Back to Level 2: LET y (sibling)
    let n4 = n2[3]
    t = n4[0]
    v = n4[1]
    print(2000)
    print(t)
    print(v)
    
    // Level 3: NUM 100
    let n5 = n4[2]
    t = n5[0]
    v = n5[1]
    print(3000)
    print(t)
    print(v)
    
    print(666666)
    return 0
}
