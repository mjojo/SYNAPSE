// Tokenize with identifiers
fn str_len(s) {
    let i = 0
    while getbyte(s, i) > 0 {
        i = i + 1
    }
    return i
}

fn io_print(s) {
    let len = str_len(s)
    let h = getstd(-11)
    write(h, s, len)
    return 0
}

fn io_println(s) {
    io_print(s)
    let h = getstd(-11)
    let nl = alloc(1)
    setbyte(nl, 0, 10)
    write(h, nl, 1)
    return 0
}

fn is_space(c) {
    if c == 32 { return 1 }
    if c == 10 { return 1 }
    if c == 13 { return 1 }
    if c == 9  { return 1 }
    return 0
}

fn is_alpha(c) {
    let result = 0
    if c >= 97 {
        if c <= 122 { 
            result = 1 
        }
    }
    if result == 1 { return 1 }
    
    if c >= 65 {
        if c <= 90 { 
            result = 1 
        }
    }
    if result == 1 { return 1 }
    
    if c == 95 { return 1 }
    
    return 0
}

fn is_digit(c) {
    if c < 48 { return 0 }
    if c > 57 { return 0 }
    return 1
}

fn is_alnum(c) {
    if is_alpha(c) == 1 { return 1 }
    if is_digit(c) == 1 { return 1 }
    return 0
}

fn print_one(c) {
    let buf = alloc(2)
    setbyte(buf, 0, c)
    setbyte(buf, 1, 0)
    io_print(buf)
    return 0
}

// Print identifier starting at position
fn print_ident(source, start) {
    io_print("ID:")
    let j = start
    let ch = getbyte(source, j)
    
    while is_alnum(ch) == 1 {
        print_one(ch)
        j = j + 1
        ch = getbyte(source, j)
    }
    io_print(" ")
    return 0
}

// Tokenize with identifiers
fn tokenize(source) {
    let i = 0
    let c = 0
    let running = 1
    
    while running == 1 {
        c = getbyte(source, i)
        
        if c == 0 {
            running = 0
        }
        
        if running == 1 {
            // Skip spaces
            if is_space(c) == 1 {
                i = i + 1
            }
            
            // Identifier
            if is_space(c) == 0 {
                if is_alpha(c) == 1 {
                    print_ident(source, i)
                    // Skip past identifier
                    while is_alnum(getbyte(source, i)) == 1 {
                        i = i + 1
                    }
                }
            }
            
            // Other chars - just skip for now
            if is_space(c) == 0 {
                if is_alpha(c) == 0 {
                    i = i + 1
                }
            }
        }
    }
    return 0
}

fn main() {
    let code = alloc(16)
    setbyte(code, 0, 102)  // f
    setbyte(code, 1, 110)  // n
    setbyte(code, 2, 32)   // space
    setbyte(code, 3, 109)  // m
    setbyte(code, 4, 97)   // a
    setbyte(code, 5, 105)  // i
    setbyte(code, 6, 110)  // n
    setbyte(code, 7, 0)
    
    tokenize(code)
    
    return 0
}
