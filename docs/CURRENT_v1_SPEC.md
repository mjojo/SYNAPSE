# SYNAPSE v1.0 - ТЕКУЩАЯ СПЕЦИФИКАЦИЯ

**Версия:** 1.0 (Рабочая)  
**Статус:** Стабильная  
**Синтаксис:** C-подобный (фигурные скобки)

---

## 1. Синтаксис

### 1.1 Функции

```synapse
fn имя(арг1, арг2) {
    // тело
    return значение
}
```

### 1.2 Переменные

```synapse
let x = 42
let y = x + 1
```

### 1.3 Условия

```synapse
if условие {
    // тело
}

if (условие) {
    // с опциональными скобками
}
```

### 1.4 Циклы

```synapse
while условие {
    // тело
}

while (i < 10) {
    i = i + 1
}
```

### 1.5 Массивы

```synapse
let arr = alloc(100)      // выделение 100 элементов (64-бит каждый)
arr[0] = 42               // запись
let x = arr[0]            // чтение
```

### 1.6 Байтовые массивы

```synapse
let buf = alloc_bytes(1024)    // выделение 1024 байт
set_byte(buf, 0, 255)          // запись байта
let b = get_byte(buf, 0)       // чтение байта
```

---

## 2. Встроенные функции

| Функция | Описание |
|---------|----------|
| `print(x)` | Вывод числа в консоль |
| `prints(s)` | Вывод строки |
| `alloc(n)` | Выделение n элементов (qword) |
| `alloc_bytes(n)` | Выделение n байт |
| `get_byte(ptr, i)` | Чтение байта по индексу |
| `set_byte(ptr, i, v)` | Запись байта по индексу |
| `strlen(s)` | Длина строки |
| `call(addr)` | Вызов JIT-кода по адресу |

---

## 3. Операторы

| Оператор | Описание |
|----------|----------|
| `+` | Сложение |
| `-` | Вычитание |
| `*` | Умножение |
| `/` | Деление |
| `%` | Остаток от деления |
| `==` | Равенство |
| `!=` | Неравенство |
| `<` | Меньше |
| `>` | Больше |
| `=` | Присваивание |

---

## 4. Типы данных

| Тип | Размер | Описание |
|-----|--------|----------|
| Числа | 64 бит | Все числа - int64 |
| Строки | ptr | Указатель на null-terminated string |
| Массивы | ptr | Указатель на выделенную память |

---

## 5. Особенности JIT

- Весь код компилируется в x64 машинный код
- Прямой вызов скомпилированных функций через `call()`
- Windows x64 ABI (RCX, RDX, R8, R9 для аргументов)
- Результат в RAX

---

## 6. Ограничения v1.0

- Нет вложенных функций
- Нет замыканий
- Нет структур (только массивы)
- Максимум 4 аргумента функции
- Нет float/double
- Нет else (только if)

---

## 7. Пример программы

```synapse
fn factorial(n) {
    if n < 2 {
        return 1
    }
    return n * factorial(n - 1)
}

fn main() {
    let result = factorial(5)
    print(result)
    return 0
}
```
