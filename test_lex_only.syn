// ULTRA MINIMAL - Only test lexing speed on small file

let lex_pos = 0
let tok_count = 0

fn is_digit(c) {
    if c >= 48 {
        if c <= 57 {
            return 1
        }
    }
    return 0
}

fn lex(src, len) {
    let i = 0
    while i < len {
        let c = get_byte(src, i)
        
        // Skip whitespace
        if c == 32 {
            i = i + 1
        } else {
            if c == 10 {
                i = i + 1
            } else {
                // Any other char = token
                tok_count = tok_count + 1
                i = i + 1
            }
        }
    }
    return tok_count
}

fn main() {
    puts("Testing lexer speed on src\\test_simple.syn")
    
    let filename = alloc(64)
    // "src\\test_simple.syn"
    set_byte(filename, 0, 115)  // s
    set_byte(filename, 1, 114)  // r
    set_byte(filename, 2, 99)   // c
    set_byte(filename, 3, 92)   // \
    set_byte(filename, 4, 116)  // t
    set_byte(filename, 5, 101)  // e
    set_byte(filename, 6, 115)  // s
    set_byte(filename, 7, 116)  // t
    set_byte(filename, 8, 95)   // _
    set_byte(filename, 9, 115)  // s
    set_byte(filename, 10, 105) // i
    set_byte(filename, 11, 109) // m
    set_byte(filename, 12, 112) // p
    set_byte(filename, 13, 108) // l
    set_byte(filename, 14, 101) // e
    set_byte(filename, 15, 46)  // .
    set_byte(filename, 16, 115) // s
    set_byte(filename, 17, 121) // y
    set_byte(filename, 18, 110) // n
    set_byte(filename, 19, 0)
    
    let h = fopen(filename, 0)
    if h < 1 {
        puts("ERROR: Cannot open file")
        return 1
    }
    
    let buf = alloc(10000)
    let bytes_read = fread(h, buf, 10000)
    fclose(h)
    
    puts("File size:")
    print(bytes_read)
    
    puts("Lexing...")
    let count = lex(buf, bytes_read)
    
    puts("Tokens:")
    print(count)
    puts("DONE")
    
    return 0
}
