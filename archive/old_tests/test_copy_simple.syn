// Test very simple copy
fn str_len(s) {
    let i = 0
    while getbyte(s, i) > 0 {
        i = i + 1
    }
    return i
}

fn io_print(s) {
    let len = str_len(s)
    let h = getstd(-11)
    write(h, s, len)
    return 0
}

fn io_println(s) {
    io_print(s)
    let h = getstd(-11)
    let nl = alloc(2)
    setbyte(nl, 0, 10)
    setbyte(nl, 1, 0)
    write(h, nl, 1)
    return 0
}

fn copy_str(source, start, len) {
    let buf = alloc(len + 1)
    
    let k = 0
    while k < len {
        let ch = getbyte(source, start + k)
        setbyte(buf, k, ch)
        k = k + 1
    }
    setbyte(buf, len, 0)
    
    return buf
}

fn main() {
    // "fn x"
    let code = alloc(8)
    setbyte(code, 0, 102)  // f
    setbyte(code, 1, 110)  // n
    setbyte(code, 2, 32)   // space
    setbyte(code, 3, 120)  // x
    setbyte(code, 4, 0)
    
    // Copy "fn" (start=0, len=2)
    let id1 = copy_str(code, 0, 2)
    io_println(id1)
    
    // Copy "x" (start=3, len=1)
    let id2 = copy_str(code, 3, 1)
    io_println(id2)
    
    return 0
}
